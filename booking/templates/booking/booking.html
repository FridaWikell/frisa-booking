{% extends 'base.html' %}
{% load static %}

{% block content %}
    <div class="container-xl">
        <div class="row">
            <p>Bookings</p>

            <h1>Courses</h1>

            {{ course }}
            <ul>
                {% for course in courses %}
                <li>
                    <strong>{{ course.name }}</strong> - {{ course.description }}
                </li>
                {% endfor %}
            </ul>
        </div>
<!--
            <h1>Course Sessions</h1>
            <ul>
                {% for session in sessions %}
                <li>
                    <strong>{{ session.course.name }}</strong> - {{ session.start_time }} to {{ session.end_time }}
                    (Spots available: {{ session.spots_available }})
                </li>
                {% endfor %}
            </ul>


        </div>
        <div>  
            {% if sessions %}
                <h2>Select a Session</h2>
                {% for session in sessions %}
                    <form method="post">
                        {% csrf_token %}
                        <input type="hidden" name="selected_session" value="{{ session.id }}">
                        <input type="hidden" name="selected_course" value="{{ selected_course_id }}">
                        <button type="submit" class="session-slot">
                            {{ session.course.name }} {{ session.start_time }} to {{ session.end_time }} - Spots: {{ session.spots_available }}
                        </button>
                    </form>
                {% endfor %}
            {% endif %} -->

            <!-- Ny 2024 02 20 -->
            <div class="row">
                {% for session in sessions %}
                <div>
                    <p>{{ session.course.name }} - {{ session.start_time }} to {{ session.end_time }}</p>
                    <!-- Button trigger modal -->
                    <form method="post" action="{% url 'book_session' session.id %}" id="bookingForm-{{ session.id }}">
                        {% csrf_token %}
                        <button type="button" class="btn btn-primary book-session-btn session-slot {% if session.spots_available == 0 %}disabled{% endif %}" 
                        {% if session.spots_available != 0 %} 
                        data-session-id="{{ session.id }}" data-bs-toggle="modal" data-bs-target="#confirmationModal"
                        {% endif %}>Book Session | <br> Available spots: {{ session.spots_available }}</button>
                    </form>
                </div>
                {% endfor %}

                <!-- Confirmation Modal -->
                <div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="confirmationModalLabel">Confirm Booking</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <p>Are you sure you want to book this session?</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-primary" id="confirmBooking">Confirm</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </div>
{% endblock content %}